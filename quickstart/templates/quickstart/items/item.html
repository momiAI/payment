{% extends "quickstart/auth/baseAuth.html" %}
{% csrf_token %}
{% block title %}햑쮏쒫썜혦{% endblock %}
{%block button%}
        <div class="header-cart">
                <a href="{% url 'quickstart:cart_view'%}" class="cart-link" title="햌쮐향햦햫햟">
                    游 햌쮐향햦햫햟
                </a>
        </div>
{%endblock%}

{% block content %}
<div id="cart-notification" class="notification">
    햑쮏쒫썜 햢쮏쐃썛쒫햣햫  햨쮐향햦햫혞 游
</div>
<div class="product-grid">
    {% for item in items %}
        <div class="product-card" data-item-id = {{item.id}}>
                <div class="product-image">
                        <img src="{{item.image.url}}" alt="Product">
                </div>

                <div class="product-content">
                        <h3 class="product-title">{{item.name}}</h3>
                        <p class="product-description">
                        {{item.description}}
                </p>

                <div class="product-footer">
                        <span class="product-price">{{item.price}}</span>

                <div class="product-actions">
                        <button class="icon-button cart" title="햆쮏쐃썛쒫쟴혧  햨쮐향햦햫혞">
                        游
                        </button>
                        <button class="icon-button buy" title="햌혞햦혝혧">
                        游눱
                        </button>
                </div>
                </div>
                </div>
        </div>
    {% endfor %}
</div>

{% endblock %}

{%block script%} 
 <script type="text/javascript" >
        function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                        const cookies = document.cookie.split(';');
                        for (let cookie of cookies) {
                        cookie = cookie.trim();
                        if (cookie.startsWith(name + '=')) {
                                cookieValue = decodeURIComponent(
                                cookie.substring(name.length + 1)
                                );
                                break;
                        }
                        }
        }
        return cookieValue;
        }

        const csrftoken = getCookie('csrftoken');

        document.querySelectorAll('.icon-button.cart').forEach(btn => {
        btn.addEventListener('click', () => {
                const itemId = btn.closest('.product-card').dataset.itemId
                const notification = document.getElementById('cart-notification');

                notification.classList.add('show');

                setTimeout(() => {
                notification.classList.remove('show');
                }, 3000);
            fetch('/item/add/', {
                method : 'POST',
                headers : {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrftoken
                },
                body : JSON.stringify({
                        item_id : itemId
                })
            })
        })
    })

    </script> 
{%endblock%}